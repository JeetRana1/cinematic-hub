// Generates public/streamApiConfig.js from env or defaults
const fs = require('fs');
const path = require('path');

const OUTPUT = path.join(__dirname, '..', 'public', 'streamApiConfig.js');

const STREAM_API = process.env.STREAM_API || 'https://convinced-nara-personal122-7da52759.koyeb.app/api/v1';
const CONSUMET_API = process.env.CONSUMET_API || 'https://api.consumet.org';
const TWOEMBED_API = process.env.TWOEMBED_API || '';
const TMDB_API_KEY = process.env.TMDB_API_KEY || '';
const YT_API_KEY = process.env.YT_API_KEY || '';

const content = `// Auto-generated by scripts/generateStreamApiConfig.js
// Configure browser-safe runtime values here (generated from env).
window.CONSUMET_API = ${JSON.stringify(CONSUMET_API)};
window.STREAM_API = ${JSON.stringify(STREAM_API)};
window.TWOEMBED_API = ${JSON.stringify(TWOEMBED_API)};
window.TMDB_API_KEY = ${JSON.stringify(TMDB_API_KEY)};
window.YT_API_KEY = ${JSON.stringify(YT_API_KEY)};
console.log('[ok] Consumet API configured:', window.CONSUMET_API);
console.log('[ok] Stream API configured:', window.STREAM_API);
console.log('[ok] 2Embed API configured:', window.TWOEMBED_API || '(not configured)');
console.log('[ok] TMDB key configured:', Boolean(window.TMDB_API_KEY));
console.log('[ok] YouTube key configured:', Boolean(window.YT_API_KEY));
`;

fs.mkdirSync(path.dirname(OUTPUT), { recursive: true });
fs.writeFileSync(OUTPUT, content, 'utf8');
console.log(`[streamApiConfig] Wrote ${OUTPUT}`);
